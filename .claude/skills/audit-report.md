# /audit-report - Generate Audit Documentation

Generate comprehensive audit reports from the audit trail for regulatory compliance reviews and internal audits.

## Usage
```
/audit-report [--period <period>] [--format <format>] [--focus <area>]
```

## Arguments
- `--period` - Time period: today, week, month, quarter, year, or custom date range
- `--format` - Output format: markdown (default), json, summary
- `--focus` - Focus area: all (default), compliance, security, access, changes

## Workflow

### Step 1: Query Audit Trail
Use `audit_log` MCP tool to retrieve audit entries:
```json
{
  "operation": "query",
  "filter": {
    "startDate": "[period start]",
    "endDate": "[period end]",
    "complianceRelevant": true
  },
  "limit": 1000
}
```

### Step 2: Query Regulations Resource
Fetch regulatory context from `regulations://frameworks` resource to map findings to requirements.

### Step 3: Spawn Audit Documenter
Spawn the `audit-documenter` subagent for professional documentation:
```
Task: Generate audit-ready documentation from trail entries
Subagent: audit-documenter
Input:
  - Audit trail entries
  - Period and focus parameters
  - Regulatory framework context
```

### Step 4: Compile Report

#### Executive Summary
- Audit period and scope
- Key statistics
- Notable events
- Compliance posture assessment

#### Detailed Sections

**Activity Summary**
- Total events logged
- Events by category
- Events by actor
- Events by result (success/failure)

**Risk Analysis**
- Events by risk level
- High-risk event details
- Trend analysis

**Compliance Events**
- Regulatory-relevant activities
- Mapping to compliance requirements
- Gaps identified

**Incident Log**
- Security incidents
- Failed operations
- Policy violations

**Recommendations**
- Process improvements
- Control enhancements
- Training needs

### Step 5: Generate Artifacts
Create supporting documentation:
- Evidence package (JSON export)
- Timeline visualization data
- Actor activity summary

## Report Template

```markdown
# Compliance Audit Report

## Report Metadata
- **Report ID**: AUD-[YYYYMMDD]-[sequence]
- **Generated**: [timestamp]
- **Period**: [start] to [end]
- **Scope**: [focus area]
- **Prepared By**: Aegis Compliance Platform

---

## Executive Summary

This audit report covers [period description] and focuses on [scope].

### Key Metrics
| Metric | Value |
|--------|-------|
| Total Events | [count] |
| Compliance Events | [count] |
| High-Risk Events | [count] |
| Failed Operations | [count] |

### Compliance Status
[Overall assessment paragraph]

---

## Activity Analysis

### Events by Category
[Table or chart data]

### Events by Actor
[Top actors and activity levels]

### Events by Risk Level
| Risk Level | Count | Percentage |
|------------|-------|------------|
| Critical   | [n]   | [%]        |
| High       | [n]   | [%]        |
| Medium     | [n]   | [%]        |
| Low        | [n]   | [%]        |

---

## Compliance Mapping

### GDPR Compliance
[Events mapped to GDPR requirements]

### eIDAS 2.0 Compliance
[Events mapped to eIDAS requirements]

### AML/KYC Compliance
[Events mapped to AML requirements]

---

## Incidents and Exceptions

### Security Events
[List of security-relevant events]

### Failed Operations
[List with investigation status]

### Policy Deviations
[Any policy violations detected]

---

## Recommendations

### Immediate Actions
1. [Critical items]

### Short-term Improvements
1. [Items for next review cycle]

### Long-term Initiatives
1. [Strategic improvements]

---

## Appendices

### A. Full Event Log
[JSON export reference]

### B. Evidence Package
[Documentation references]

### C. Methodology
[Audit methodology description]

---

*Report generated by Aegis Compliance Platform*
*For questions, contact compliance@thesafecompany.com*
```

## Example Usage

```
> /audit-report --period month --focus compliance

Generating Audit Report...
- Querying audit trail for past 30 days
- Found 1,247 compliance-relevant events
- Spawning audit-documenter for analysis
- Compiling report...

Audit Report Generated
======================
Report ID: AUD-20240115-001
Period: 2023-12-15 to 2024-01-15
Events Analyzed: 1,247

Key Findings:
- 98.2% operations successful
- 3 high-risk events requiring review
- 2 potential compliance gaps identified

Full report saved to: audit-report-20240115.md
Evidence package: audit-evidence-20240115.json
```
