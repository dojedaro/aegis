name: Deploy

on:
  push:
    branches: [main]
    tags:
      - 'v*'

jobs:
  # Vercel handles deployment automatically via GitHub integration
  # This workflow only creates releases when a new version tag is pushed

  create-release:
    name: Create Release
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/tags/v')

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          name: Release ${{ github.ref_name }}
          body: |
            ## Aegis ${{ github.ref_name }}

            ### Live Deployments
            - **Frontend:** https://aegis-web-xi.vercel.app
            - **Backend API:** https://aegis-backend-ermb.onrender.com
            - **API Docs:** https://aegis-backend-ermb.onrender.com/api-docs

            ### Features
            - AI-powered compliance checking with Claude API
            - RAG-based regulation search (27 articles)
            - Real-time PII detection
            - Risk assessment engine
            - Audit trail with immutable logging
            - JWT authentication

            ### Supported Frameworks
            - GDPR
            - eIDAS 2.0
            - AML/6AMLD
            - EU AI Act

            See [README](https://github.com/dojedaro/aegis#readme) for documentation.
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
